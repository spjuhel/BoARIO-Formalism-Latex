% ENCODAGE
\usepackage{setspace}
\usepackage{lmodern}
%\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[main=english,french]{babel}
\usepackage{textgreek}
\usepackage{fontspec}
\usepackage[dvipsnames]{xcolor} % pour ajouter de la couleur (si besoin)

\setcounter{tocdepth}{3} % Pour que les subsubsections n'apparaissent pas dans la TOC
\setcounter{secnumdepth}{3} % Pour que les subsubsections ne soient pas numérotées
%\usepackage{fixltx2e}
\usepackage{fmtcount} % equivalent to \usepackage[super]{nth}

%%%%%%%%%% Gestions des marges %%%%%%%%%%
\usepackage{geometry} % Si on a besoin d'une configuration plus précise des marges
\geometry{a4paper,                % format de papier
  % Définition des marges :
  left= 3cm,right = 2cm,  % marge intérieure extérieure à la page
  top = 3cm,bottom = 3cm,
  % En-tête et pied de page :
  headheight=10mm,         % espace réservé à l'en-tête dans la marge top
  % headsep=3mm,            % espace entre le corps et l'en-tête
  % footskip=9mm            % espace entre le corps et le pied de page
  marginparwidth = 20mm,
  %showframe
}

\raggedbottom{}
\reversemarginpar{}
% \usepackage{showframe} % pour afficher les traits des marges

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%% Gestion maths %%%%%%%%%%
\usepackage{amsmath,amssymb,amsfonts,amsthm}
% \usepackage{mathtools} % version modifiée de amsmath, ajoute des symboles, etc.
\usepackage{mathrsfs}% pour rajouter un format de lettres façon calligraphie en math mode.
\DeclareMathOperator{\sinc}{sinc}
\DeclareMathOperator{\e}{e}
\usepackage[locale = FR]{siunitx} % Pour gérer les unités
\sisetup{inter-unit-product=\ensuremath{{}\cdot{}}} % pour mettre des points médians entre les unités quand il y en a plusieurs
\sisetup{separate-uncertainty=true,multi-part-units=single} % pour faire des incertitudes en écrivant \SI{valeur(incertitude)}{unité}
\DeclareSIUnit\vitesse{\meter\per\second}
\usepackage{eurosym}
\DeclareSIUnit{\octet}{o}
\usepackage{xparse}
\usepackage{bm}
\input{config/myionotations.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%% Graphics / Table / List %%%%%%%%%%%
\usepackage{graphicx,array,tikz,multirow}
\usepackage{wrapfig}
\usepackage{lscape}
\usepackage{rotating}
\graphicspath{{/home/sjuhel/imgs-general}{/home/sjuhel/imgs-general/handmade}{/home/sjuhel/imgs-general/logos}{/home/sjuhel/imgs-general/diagrams}{/home/sjuhel/imgs-general/ARIO-schemes}{/home/sjuhel/imgs-general/ARIO-schemes/simple-scheme}{/home/sjuhel/imgs-general/General-schemes}{/home/sjuhel/imgs-general/Plots}{/home/sjuhel/imgs-general/Plots/GlobalTCs}{/home/sjuhel/imgs-general/Plots/GlobalFloods}{/home/sjuhel/imgs-general/Plots/CompoundEvents}{/home/sjuhel/imgs-general/Plots/CompoundEvents/Examples}{/home/sjuhel/imgs-general/Plots/Sensitivity}{/home/sjuhel/imgs-general/Plots/Sensitivity/archive}{/home/sjuhel/imgs-general/img}{/home/sjuhel/imgs-general/img/results}{/home/sjuhel/imgs-general/Plots-from-articles}{/home/sjuhel/imgs-general/Press-Titles}{/home/sjuhel/imgs-general/Examples-Placeholders}{/home/sjuhel/imgs-general/Photos-Examples}{/home/sjuhel/imgs-general/tikz}{/home/sjuhel/imgs-general/AR6}{/home/sjuhel/imgs-general/AR6/INTEREG}{/home/sjuhel/imgs-general/Schemes-from-articles}}
\usepackage[font={small,it}]{caption}
\usepackage{subcaption} % permet de faire des subfigures (remplace le package subfig)
\usepackage{svg,float}
\usepackage{booktabs,paralist}
\usepackage{xltabular}
\newcolumntype{x}[1]{>{\centering\arraybackslash\hspace{0pt}}p{#1}}
\usepackage[section]{placeins}
\usepackage{hanging}
\usepackage{awesomebox}
\usepackage{rotating}
\usepackage{listings}
\usepackage{lstautogobble}  % Fix relative indenting
\usepackage{color}          % Code coloring
\usepackage{zi4}            % Nice font

\definecolor{bluekeywords}{rgb}{0.13, 0.13, 1}
\definecolor{greencomments}{rgb}{0, 0.5, 0}
\definecolor{redstrings}{rgb}{0.9, 0, 0}
\definecolor{graynumbers}{rgb}{0.5, 0.5, 0.5}

\usepackage{listings}
\lstset{
    autogobble,
    columns=fullflexible,
    showspaces=false,
    showtabs=false,
    breaklines=true,
    showstringspaces=false,
    breakatwhitespace=true,
    escapeinside={(*@}{@*)},
    commentstyle=\color{greencomments},
    keywordstyle=\color{bluekeywords},
    stringstyle=\color{redstrings},
    numberstyle=\color{graynumbers},
    basicstyle=\ttfamily\footnotesize,
    frame=l,
    framesep=12pt,
    xleftmargin=12pt,
    tabsize=4,
    captionpos=b
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%% Header / Foot %%%%%%%%%%%
\usepackage{fancyhdr,emptypage} % garantit que les pages blanches avant les débuts de chapitres soient vraiment blanches (pas d'en-tête ni de pied de page)
\let\cleardoublepage\clearpage

\fancypagestyle{plain}{ %% Page chapitre, toc ...
    \fancyhead{}\fancyfoot[C]{\thepage}
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0pt}
}

%%%%%%%%%%% Page normale
\pagestyle{fancy}
    % \renewcommand{\chaptermark}[1]{\markboth{\chaptername \ \thechapter.\ #1}{}} % sert à personnaliser l'affichage de \leftmark (ici : le mot "Chapitre", le numéro, un point, et le titre du chapitre, sans écrire en majuscules)
    % \renewcommand{\chaptermark}[1]{\markleft{\chaptername \ \thechapter.\ #1}{}}
    % \renewcommand{\sectionmark}[1]{\markright{\thesection.\ #1}} % sert à personnaliser l'affichage de \rightmark (ici : le numéro et le titre de la section en cours, sans écrire en majuscules)
    \fancyhf{} % assure que les entête et pieds de page sont vides au départ
    \fancyhead[LE]{\selectfont\nouppercase{\leftmark}}
    \fancyhead[RO]{\selectfont\nouppercase{\rightmark}}
    \fancyfoot[C]{\thepage}
% Explications :
% L = left, R = right, C = center, E = even pages, O = odd pages
%\leftmark : adds name and number of the current top-level structure (for example, Chapter for reports and books classes; Section for articles ) in uppercase letters.
%\rightmark : adds name and number of the current next to top-level structure (Section for reports and books; Subsection for articles) in uppercase letters.

%%%%%%%%%%% Personnaliser les premières pages des chapitres
\usepackage[Lenny]{fncychap}
\ChNameVar{\fontsize{25}{25}\usefont{OT1}{phv}{m}{n}\selectfont}
\ChRuleWidth{0pt}
\ChNumVar{\fontsize{60}{62}\selectfont\textcolor{curcolor}}

\makeatletter
\ChTitleVar{\Huge\rm}
\renewcommand{\DOCH}{%
\setlength{\fboxrule}{\RW} % Let fbox lines be controlled by
\fbox{\CNV\FmN{\@chapapp}\space \CNoV\thechapter}\par\nobreak{}
\vskip 20\p@}
\renewcommand{\DOTIS}[1]{%
\CTV\bfseries\FmTi{#1}\par\nobreak{}
\vskip 20\p@}
\makeatother

\renewcommand{\thesection}{\arabic{section}}

% Pour la table des matières
\usepackage[nohints,tight]{minitoc}		% Mini table des matières, en français
\setcounter{minitocdepth}{2} % Mini-toc détaillées (sections/sous-sections)
\setlength{\mtcindent}{-1em} % décalage des minitoc à gauche
\dominitoc{}

\usepackage[nottoc]{tocbibind} % pour que la bibliographie apparaisse dans la table des matières (avec l'option pour que la table des matières elle-même n'apparaisse pas dans la table des matières).
% \usepackage{tocloft}% pour pouvoir modifier les tailles d'espacement dans la table des matières
\usepackage[titles]{tocloft}
\setlength{\cftchapnumwidth}{6.5em} % Adjust the value as needed
\renewcommand{\cftchappresnum}{Chapter\ }
\renewcommand{\cftchapaftersnum}{\ --}
% Fix space between numbering and figure caption in list of figures %%%
\setlength{\cftfignumwidth}{3em}
\setlength{\cfttabnumwidth}{3em}
%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%% Divers %%%%%%%%%%%
\usepackage{csquotes}
\usepackage[colorinlistoftodos,prependcaption,textsize=scriptsize,
textwidth=2.2cm]{todonotes}
\usepackage[inline,shortlabels]{enumitem}
\usepackage{textcomp} % rajoute des symboles
\usepackage{epigraph} % pour rajouter des citations en début de chapitre  \epigraph{Citation}}{Auteur}
\usepackage{titling}
\usepackage{lipsum}
\usepackage{threeparttable}
\usepackage{xspace}
\usepackage{afterpage}
\renewcommand{\baselinestretch}{1.2} % interligne
\usepackage{footnote}
\makesavenoteenv{tabular}
\usepackage{tablefootnote}
\usepackage{url}

%%% Have per chapter appendix with correct counter and so on %%%
\usepackage[title]{appendix}
\usepackage{chngcntr}
\usepackage{etoolbox}
\AtBeginEnvironment{subappendices}{%
   \newpage
%   \section*{Appendix}
%   \addcontentsline{toc}{section}{\protect\numberline{\thesection}Appendix}
% %  \counterwithin{figure}{section}
% %  \counterwithin{table}{section}
}
% End of subappendices environment
%\AtEndEnvironment{subappendices}{%
%  \counterwithout{figure}{section}
%  \counterwithout{table}{section}
%}
%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%% Links ref  %%%%%%%%%%%
\usepackage{bookmark}
\usepackage{acronym}
\usepackage{cleveref} % noabbrev
%\Crefname{figure}{Fig.}{Figs.} % traduction des références aux figures/tables/équations
%\crefname{figure}{fig.}{figs.}
%\Crefname{equation}{Eq.}{Eqs.}
%\crefname{equation}{eq.}{eqs.}
%\Crefname{table}{Table.}{Tables.}
%\crefname{table}{table.}{tables.}

% Configuration de hyperref
\definecolor{color_ref}{rgb}{0.18, 0.31, 0.31} % couleur cite
\definecolor{color_link}{RGB}{36, 56, 141}
\definecolor{curcolor}{RGB}{113,127,184} % couleur des liens (bleu clair)

\hypersetup{
	colorlinks=true, % colore les liens au lieu de les encadrer
	pdfstartview=FitV, % ouvre le PDF de façon à ce qu'il prenne la taille verticale de l'écran
	urlcolor=color_link, % choix de la couleur des liens URL
	linkcolor= color_link, % choix de la couleur des liens internes (table des matières, etc.)
	citecolor=color_ref % choix de la couleur des liens de citations
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%% Bibliography ref  %%%%%%%%%%%
\usepackage[hyperref=true,%
      natbib=true,%
			backref=true,date=year,%
			backend=biber,%
			url=false,doi=false,isbn=false,%
			minbibnames=6, % nb min authors in biblio
			maxbibnames=6, % nb max authors in biblio
			maxcitenames=1,mincitenames=1, % nb min authors as textual
			maxalphanames=1, %nb author ref
			style=authoryear,%authoryear, numeric ,  alphabetic
			sorting=nyt,%
      refsegment=chapter % references per chapters
      ]{biblatex}%

\defbibheading{subbibforchap}[Chapter~\thechapter{} Bibliography]{\section*{#1}}
\renewcommand*{\bibfont}{\footnotesize}
\setlength\bibitemsep{\itemsep}
\renewbibmacro{in:}{} % remove In

\renewcommand*{\labelalphaothers}{}
\DeclareLabelalphaTemplate{
  \labelelement{
    \field[final]{shorthand}
    \field{labelname}
    \field{label}
  }
  \labelelement{\literal{,\addhighpenspace}}
  \labelelement{\field{year}}
}

\AtEveryBibitem{%
    \clearfield{note} % Remove note
    \clearlist{language} % Remove doi
}

% >> bib field filter
\DeclareSourcemap{
    \maps[datatype=bibtex]{
        % remove fields that are always useless
        \map{
            \step[fieldset=abstract, null]
            \step[fieldset=pagetotal, null]
            \step[fieldset=note, null]
        }
        % remove URLs for types that are primarily printed
        \map{
            \pernottype{software}
            \pernottype{online}
            \pernottype{report}
            \pernottype{techreport}
            \pernottype{standard}
            \pernottype{manual}
            \pernottype{misc}
            \step[fieldset=url, null]
            \step[fieldset=urldate, null]
        }
        \map{
            \pertype{inproceedings}
            % remove mostly redundant conference information
            \step[fieldset=venue, null]
            \step[fieldset=eventdate, null]
            \step[fieldset=eventtitle, null]
            % do not show ISBN for proceedings
            \step[fieldset=isbn, null]
            % Citavi bug
            \step[fieldset=volume, null]
        }
      }
    }
% <<

% \usepackage{mystyle}

%%%% COLORS
\definecolor{Ftitle}{RGB}{0, 155, 178}

%%% Local Variables:
%%% mode: LaTeX
%%% TeX-master: "../main"
%%% End:
